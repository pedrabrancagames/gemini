<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghostbusters AR</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Ca√ße fantasmas em realidade aumentada!">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    
    <!-- External Libraries -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-ar-js@3.4.5/dist/aframe-ar.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="screen active">
        <div class="loading-container">
            <img src="assets/images/logo.png" alt="Ghostbusters AR" class="logo">
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <p id="loading-text">Carregando assets...</p>
            <span id="loading-percentage">0%</span>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen">
        <div class="login-container">
            <img src="assets/images/logo.png" alt="Ghostbusters AR" class="logo">
            <h1>Ghostbusters AR</h1>
            <p class="subtitle">Ca√ße fantasmas em realidade aumentada!</p>
            
            <div class="login-buttons">
                <button id="google-login" class="login-btn primary">
                    <span>üîç</span> Entrar com Google
                </button>
                <button id="email-login" class="login-btn secondary">
                    <span>üìß</span> Entrar com Email
                </button>
                <button id="anonymous-login" class="login-btn tertiary">
                    <span>üëª</span> Jogar como An√¥nimo
                </button>
            </div>
            
            <div class="privacy-notice">
                <p>Precisaremos de acesso √† c√¢mera e localiza√ß√£o para funcionar.</p>
            </div>
        </div>
    </div>

    <!-- Email Login Modal -->
    <div id="email-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Login com Email</h2>
            <form id="email-form">
                <input type="email" id="email" placeholder="Seu email" required>
                <input type="password" id="password" placeholder="Sua senha" required>
                <button type="submit">Entrar</button>
                <button type="button" id="register-btn">Criar Conta</button>
            </form>
        </div>
    </div>

    <!-- Location Selection Screen -->
    <div id="location-screen" class="screen">
        <div class="location-container">
            <h2>Escolha um Local</h2>
            <div id="map" class="map-container"></div>
            <div class="location-info">
                <h3 id="selected-location">Local Teste - Florian√≥polis, SC</h3>
                <p id="location-details">Raio: 100 metros</p>
                <button id="confirm-location" class="confirm-btn">Confirmar Local</button>
            </div>
        </div>
    </div>

    <!-- Permission Screen -->
    <div id="permission-screen" class="screen">
        <div class="permission-container">
            <img src="assets/images/pke_meter.png" alt="P.K.E. Meter" class="pke-icon">
            <h2>Permiss√µes Necess√°rias</h2>
            <div class="permission-list">
                <div class="permission-item">
                    <span class="permission-icon">üì∑</span>
                    <div>
                        <h3>C√¢mera</h3>
                        <p>Para visualizar fantasmas em realidade aumentada</p>
                    </div>
                </div>
                <div class="permission-item">
                    <span class="permission-icon">üìç</span>
                    <div>
                        <h3>Localiza√ß√£o</h3>
                        <p>Para posicionar voc√™ no mapa de ca√ßa</p>
                    </div>
                </div>
            </div>
            <button id="grant-permissions" class="permission-btn">Conceder Permiss√µes</button>
        </div>
    </div>

    <!-- Game Screen (AR) -->
    <div id="game-screen" class="screen">
        <!-- AR Scene -->
        <a-scene 
            id="ar-scene"
            embedded 
            arjs="sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
            vr-mode-ui="enabled: false"
            renderer="logarithmicDepthBuffer: true;"
            loading-screen="enabled: false">
            
            <!-- Assets -->
            <a-assets>
                <a-asset-item id="ghost-model" src="assets/models/ghost.glb"></a-asset-item>
            </a-assets>

            <!-- Camera -->
            <a-camera 
                id="ar-camera"
                position="0 0 0"
                look-controls="enabled: false"
                cursor="fuse: false; rayOrigin: mouse;"
                raycaster="far: 10000; interval: 1000; objects: .raycastable">
            </a-camera>

            <!-- Lighting -->
            <a-light type="ambient" color="#404040"></a-light>
            <a-light type="directional" position="0 1 0" color="#ffffff"></a-light>
        </a-scene>

        <!-- Game UI Overlay -->
        <div class="game-ui">
            <!-- Top Left - Logo/Settings -->
            <div class="ui-top-left">
                <button id="settings-btn" class="ui-btn">
                    <img src="assets/images/logo.png" alt="Settings" class="ui-icon">
                </button>
            </div>

            <!-- Top Right - Inventory -->
            <div class="ui-top-right">
                <button id="inventory-btn" class="ui-btn">
                    <img src="assets/images/ghost_trap.png" alt="Invent√°rio" class="ui-icon">
                    <span id="inventory-count" class="inventory-counter">0/10</span>
                </button>
            </div>

            <!-- Bottom - Proton Pack -->
            <div class="ui-bottom">
                <div id="proton-pack" class="proton-pack">
                    <img src="assets/images/proton_pack.png" alt="Proton Pack" class="pack-image">
                    <button id="fire-btn" class="fire-button">
                        <div class="crosshair"></div>
                    </button>
                </div>
            </div>

            <!-- Out of Range Indicator -->
            <div id="out-of-range" class="out-of-range hidden">
                <img src="assets/images/pke_meter.png" alt="P.K.E. Meter" class="pke-meter">
                <div class="range-info">
                    <h3>Fora do Raio!</h3>
                    <p>Voc√™ est√° fora do raio, siga o medidor de dist√¢ncia</p>
                    <div class="distance">
                        <span id="distance-text">Calculando...</span>
                        <div class="direction-arrow" id="direction-arrow">‚Üí</div>
                    </div>
                </div>
            </div>

            <!-- Inventory Full Warning -->
            <div id="inventory-full" class="inventory-full hidden">
                <img src="assets/images/pke_meter.png" alt="P.K.E. Meter" class="pke-meter">
                <div class="warning-info">
                    <h3>Invent√°rio Cheio!</h3>
                    <p>V√° at√© a Unidade de Conten√ß√£o</p>
                </div>
            </div>

            <!-- Capture Progress -->
            <div id="capture-progress" class="capture-progress hidden">
                <div class="progress-ring">
                    <div class="progress-fill"></div>
                    <span class="progress-text">Capturando...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div id="inventory-modal" class="modal">
        <div class="modal-content inventory-content">
            <span class="close">&times;</span>
            <h2>Invent√°rio de Fantasmas</h2>
            <div id="ghost-list" class="ghost-grid">
                <!-- Ghost items will be populated here -->
            </div>
            <div class="inventory-info">
                <p>Slots: <span id="slots-info">0/10</span></p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Configura√ß√µes</h2>
            <div class="settings-options">
                <div class="setting-item">
                    <label for="sound-toggle">Som</label>
                    <input type="checkbox" id="sound-toggle" checked>
                </div>
                <div class="setting-item">
                    <label for="notifications-toggle">Notifica√ß√µes</label>
                    <input type="checkbox" id="notifications-toggle" checked>
                </div>
                <div class="setting-item">
                    <button id="logout-btn" class="logout-btn">Sair</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Scanner Modal -->
    <div id="qr-scanner-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Escaneie o QR Code da Unidade</h2>
            <div id="qr-scanner" class="qr-scanner">
                <video id="qr-video" autoplay muted playsinline></video>
                <div class="scanner-overlay">
                    <div class="scanner-frame"></div>
                </div>
            </div>
            <p>Posicione o QR Code da Unidade de Conten√ß√£o dentro do quadro</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/location.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ar.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/qr-scanner.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(registrationError => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>